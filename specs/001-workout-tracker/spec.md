# Feature Specification: Workout Tracker Mobile App

**Feature Branch**: `001-workout-tracker`
**Created**: 2025-11-29
**Status**: Draft
**Input**: User description: "筋トレ記録モバイルアプリ - React + Capacitor (iOS/Android対応) - ワークアウト記録、履歴管理、トレーニングライブラリ、片手操作UI、セット間タイマー機能"

## User Scenarios & Testing _(mandatory)_

### User Story 1 - Basic Workout Recording (Priority: P1)

トレーニング中のユーザーは、ジムで素早くワークアウトセッションを開始し、部位を選択し、種目(例: ベンチプレス)を選び、セットごとに重量とレップ数を記録できる。記録した内容は端末に保存され、次回のトレーニング時に過去の最大重量が自動表示される。

**Why this priority**: これがアプリの核心的価値。ユーザーがトレーニング記録を正確に残せなければ、進捗追跡も分析も不可能。MVP として最も重要。

**Independent Test**: ユーザーが新規セッションを開始→部位選択→種目選択→重量とレップ数入力→保存、の一連の流れを完了でき、保存したデータがアプリ再起動後も残っていることを確認できる。

**Acceptance Scenarios**:

1. **Given** アプリを開いている状態、**When** 「新規ワークアウト」をタップし、部位「胸」を選択、種目「ベンチプレス」を入力、重量「80kg」レップ数「10」を入力して保存、**Then** ワークアウトが正常に保存され、履歴に表示される
2. **Given** 過去に「ベンチプレス 80kg×10」を記録済み、**When** 新規セッションで再び「ベンチプレス」を選択、**Then** 「前回の最大: 80kg」が自動表示される
3. **Given** ワークアウトセッション記録中、**When** 「セット追加」をタップ、**Then** 新しいセット入力欄が追加され、重量とレップ数を入力できる
4. **Given** 3セット入力済み、**When** 2セット目の「削除」ボタンをタップ、**Then** 2セット目が削除され、残りのセットが詰められて表示される

---

### User Story 2 - One-Handed Optimized Input (Priority: P2)

ジムでダンベルやバーベルを持ちながら片手で操作するユーザーは、重量やレップ数の入力フィールドをタップすると画面下部に大きなテンキーパッドが表示され、クイックボタン(重量: 2.5kg刻み、レップ数: 5, 8, 10, 12...)で素早く入力できる。

**Why this priority**: ユーザー体験の大幅な向上。トレーニング中は両手が使えないことが多く、片手操作に最適化されたUIは競合との差別化要因となる。

**Independent Test**: 重量入力フィールドをタップ→画面下部にテンキーパッド表示→クイックボタン「22.5kg」をタップ→「完了」で確定、の流れがスムーズに完了できることを確認。

**Acceptance Scenarios**:

1. **Given** ワークアウト記録画面で重量入力フィールドをタップ、**When** 画面下部にテンキーパッドが表示、**Then** 2.5kg刻みのクイックボタン(20kg, 22.5kg, 25kg...)が表示され、タップで入力できる
2. **Given** レップ数入力フィールドをタップ、**When** 画面下部にテンキーパッドが表示、**Then** よく使う回数のクイックボタン(5, 8, 10, 12...)が表示され、整数のみ入力可能
3. **Given** 重量入力テンキーパッド表示中、**When** 「2」「2」「.」「5」とタップ、**Then** 「22.5」と表示され、小数点入力が可能
4. **Given** テンキーで値を入力済み、**When** 「完了」ボタンをタップ、**Then** 入力値が確定され、テンキーパッドが閉じる

---

### User Story 3 - Rest Timer with Lock Screen Support (Priority: P2)

トレーニング中のユーザーは、セット完了後にタイマーを開始し、iPhoneがロック状態(スリープモード)でもロック画面にタイマーが表示され、通知からタイマーを一時停止・再開・スキップでき、タイマー終了時にバイブレーションと通知音で知らされる。

**Why this priority**: セット間の休憩時間を正確に管理することで、トレーニング効果を最大化。ロック画面対応により、バッテリー消費を抑えつつタイマーを使える。

**Independent Test**: セット完了後にタイマー開始→iPhoneをロック→ロック画面にタイマー表示→通知から一時停止・再開→タイマー終了時に通知音とバイブレーション、の流れを確認。

**Acceptance Scenarios**:

1. **Given** セット完了後、**When** 「タイマー開始」ボタンをタップし、60秒を選択、**Then** タイマーがカウントダウンを開始し、終了通知がスケジュールされる
2. **Given** タイマー稼働中、**When** iPhoneをロック(スリープモード)、**Then** アプリがバックグラウンドで実行中の場合、ロック画面にタイマーが通知として表示され、残り時間が更新される(ベストエフォート)
3. **Given** ロック画面にタイマー表示中、**When** 通知の「一時停止」ボタンをタップ、**Then** アプリがバックグラウンドで実行中の場合、タイマーが一時停止し、「再開」ボタンが表示される(ベストエフォート)
4. **Given** タイマーが0秒に到達、**When** カウントダウン終了、**Then** アプリが強制終了されていない限り、バイブレーションと通知音が鳴り、「休憩終了」通知が表示される

---

### User Story 4 - Workout History Review (Priority: P3)

ユーザーは過去のワークアウト履歴を日付順で閲覧し、過去のワークアウトメニューを選択して再利用でき、履歴から詳細(部位、種目、重量、レップ数)を確認できる。

**Why this priority**: 進捗追跡と継続的な改善のために重要だが、まずは記録できることが優先。履歴機能は後から追加しても価値を損なわない。

**Independent Test**: 「履歴」タブを開く→過去のワークアウトリストが日付順に表示→任意の履歴をタップ→詳細が表示される、の流れを確認。

**Acceptance Scenarios**:

1. **Given** 過去3日間でワークアウトを記録済み、**When** 「履歴」タブを開く、**Then** 過去のワークアウトが日付順(最新が上)で一覧表示される
2. **Given** 履歴一覧で2024年11月25日のワークアウトをタップ、**When** 詳細画面を開く、**Then** その日の部位、種目、セットごとの重量・レップ数が表示される
3. **Given** 過去のワークアウト詳細画面、**When** 「このメニューを再利用」ボタンをタップ、**Then** 同じ種目構成で新規ワークアウトセッションが開始される

---

### User Story 5 - Exercise Library Management (Priority: P4)

ユーザーは部位ごとにトレーニング種目を登録し、各種目に参考動画のURLを追加でき、登録した種目リストを部位別に閲覧し、種目を編集・削除できる。

**Why this priority**: トレーニングのバリエーションを増やし、正しいフォームを学ぶために有用だが、基本的な記録機能が動作すれば無くても使える。

**Independent Test**: 「ライブラリ」タブを開く→「新規種目追加」→部位「背中」、種目名「デッドリフト」、動画URL入力→保存→ライブラリに表示される、の流れを確認。

**Acceptance Scenarios**:

1. **Given** 「ライブラリ」タブを開いている、**When** 「新規種目追加」をタップし、部位「脚」、種目名「スクワット」、動画URL「https://youtube.com/...」を入力して保存、**Then** ライブラリに「脚 > スクワット」が表示される
2. **Given** ライブラリに複数の種目が登録済み、**When** 部位フィルタで「胸」を選択、**Then** 胸に関連する種目のみが表示される
3. **Given** ライブラリで「ベンチプレス」を選択、**When** 「編集」ボタンをタップし、種目名を「インクラインベンチプレス」に変更して保存、**Then** ライブラリに更新された種目名が表示される
4. **Given** ライブラリで「レッグエクステンション」を選択、**When** 「削除」ボタンをタップして確認、**Then** その種目がライブラリから削除される

---

### User Story 6 - Seamless Navigation (Priority: P1)

ユーザーは画面下部のタブバーで「記録」「履歴」「ライブラリ」の3画面を素早く切り替えられ、ダークテーマのスタイリッシュなUIで快適に操作できる。

**Why this priority**: ナビゲーションはアプリの基盤。全ての機能へのアクセスを提供するため、P1機能と並行して実装必須。

**Independent Test**: アプリ起動→タブバーで「履歴」タップ→履歴画面表示→「ライブラリ」タップ→ライブラリ画面表示→「記録」タップ→記録画面表示、の流れがスムーズに動作することを確認。

**Acceptance Scenarios**:

1. **Given** アプリ起動時、**When** 画面下部を確認、**Then** 「記録」「履歴」「ライブラリ」の3つのタブが表示される
2. **Given** 「記録」タブ表示中、**When** 「履歴」タブをタップ、**Then** 履歴画面に遷移し、タブバーの「履歴」がアクティブ状態になる
3. **Given** アプリ全体、**When** 画面を確認、**Then** ダークテーマ(黒背景、白文字)で統一されたUIが表示される

---

### Edge Cases

- **データが無い状態での表示**: 初回起動時やデータ削除後、履歴やライブラリが空の場合、「まだデータがありません」などのメッセージを表示する
- **過去の最大重量が見つからない場合**: 新しい種目を初めて記録する際、「前回の最大」は表示しない、または「初回記録」と表示
- **タイマー実行中のアプリ終了**: タイマー開始時に終了通知をスケジュール(確実に実行)。アプリがバックグラウンドで実行中であれば、リアルタイム更新と対話的な操作が可能(ベストエフォート)。強制終了後はiOSではスケジュール済み終了通知のみ保証、Androidはプラットフォーム依存(通常停止なら通知継続、強制停止なら動作保証なし)
- **ロック画面でのタイマー操作**: アプリ/プロセスが生存中は、通知の一時停止・再開・スキップボタンが正常に動作し、アプリを開かずに制御できる(ベストエフォート)。強制終了後は動作しない
- **セット数の上限**: 現実的には1種目あたり20セット程度が上限だが、システムとしては制限を設けず、ユーザーの入力を妨げない
- **重量やレップ数の異常値**: 重量0kg未満やレップ数0回未満など、現実的にありえない値は入力時にエラー表示(例: 「1以上の値を入力してください」)
- **動画URLの検証**: ライブラリに登録する動画URLが不正な形式の場合、警告を表示するが、登録は許可する(後で修正可能)
- **同じ種目名の重複登録**: ライブラリで同じ部位に同じ種目名を重複登録することは**禁止**する。データベースのUNIQUE(name, bodyPart)制約により、重複登録時にエラーメッセージ(例: 「種目"ベンチプレス"は既に部位"胸"に存在します」)を表示する。バリエーション(例: バーベル・ベンチプレスとダンベル・ベンチプレス)を登録したい場合は、種目名を区別して登録する必要がある
- **オフライン状態**: 全データは端末に保存されるため、ネットワーク接続が無くても全機能が動作する
- **ストレージ容量不足**: 端末のストレージが不足している場合、データ保存時にエラーメッセージを表示し、ユーザーに通知

## Requirements _(mandatory)_

### Functional Requirements

#### ワークアウト記録機能

- **FR-001**: ユーザーは新規ワークアウトセッションを開始できる
- **FR-002**: ユーザーは部位(胸、背中、脚、肩、腕など)を選択できる
- **FR-003**: ユーザーは種目名を手動入力またはライブラリから選択できる
- **FR-004**: ユーザーはセットごとに重量(kg)とレップ数を記録できる
- **FR-005**: ユーザーは複数セットを追加・削除できる
- **FR-006**: ユーザーは記録したワークアウトを保存できる
- **FR-007**: システムは同じ種目の過去の最大重量(Max)を自動で表示する
- **FR-008**: システムはSQLiteデータベース(@capacitor-community/sqlite)を使用して、すべてのデータを端末のローカルストレージに永続化する。リレーショナルデータモデルにより、ワークアウトセッション、種目、セットの関係性を保持し、大量データの効率的なクエリを実現する

#### 履歴管理機能

- **FR-009**: ユーザーは過去のワークアウト履歴を日付順(降順)で閲覧できる
- **FR-010**: ユーザーは過去のワークアウトメニューを選択して再利用できる
- **FR-011**: ユーザーは履歴からワークアウトの詳細(部位、種目、重量、レップ数)を確認できる

#### トレーニングライブラリ機能

- **FR-012**: ユーザーは部位ごとにトレーニング種目を登録できる
- **FR-013**: ユーザーは各種目に参考動画のURLを登録できる
- **FR-014**: ユーザーは登録した種目リストを部位別に閲覧できる
- **FR-015**: ユーザーは種目を編集・削除できる

#### 片手操作最適化UI機能

- **FR-016**: ユーザーが重量またはレップ数の入力フィールドをタップすると、画面下部に大きなテンキーパッドが表示される
- **FR-017**: ユーザーは重量入力時に2.5kg刻みのクイックボタン(20kg, 22.5kg, 25kg...)で素早く入力できる
- **FR-018**: ユーザーはレップ数入力時によく使う回数のクイックボタン(5, 8, 10, 12...)で素早く入力できる
- **FR-019**: 重量入力では小数点入力が可能で、レップ数入力では整数のみ入力可能
- **FR-020**: ユーザーはテンキーの「完了」ボタンで入力を確定できる

#### セット間タイマー機能

- **FR-021**: ユーザーはセット完了後にタイマーを開始できる
- **FR-022**: ユーザーはタイマーの秒数をカスタマイズできる(60秒、90秒、120秒などのプリセット、またはカスタム入力)
- **FR-023**: システムはiPhoneのロック画面(スリープモード中)でもタイマーを通知として表示する
- **FR-024**: ユーザーはロック画面の通知からタイマーを一時停止・再開・スキップできる
- **FR-025**: システムはタイマー終了時にバイブレーションと通知音で知らせる

#### ナビゲーション機能

- **FR-026**: ユーザーはタブバーで「記録」「履歴」「ライブラリ」の3画面を切り替えられる
- **FR-027**: システムはダークテーマ(黒背景、白文字)のUIを提供する

#### データ永続化とオフライン対応

- **FR-028**: すべてのデータは端末のローカルストレージに保存され、ネットワーク接続無しで動作する
- **FR-029**: データはアプリ再起動後も保持される
- **FR-030**: ユーザーはワークアウト履歴とライブラリ全体をJSON形式でエクスポートし、バックアップとして保存できる。また、エクスポートしたJSONからデータベースを復元し、デバイス移行時やデータ損失時にデータを回復できる
- **FR-031**: システムはスキーマバージョン管理により、将来的なデータベース構造の変更を安全に適用できる。`schema_version` テーブルで現在のバージョンを追跡し、マイグレーションスクリプトの実行状態を管理する
- **FR-032**: システムは外部キー制約(ON DELETE CASCADE)により、親レコード削除時に子レコードを自動削除し、データ整合性を保証する。セッション削除時に関連する種目とセットがカスケード削除される

### Key Entities

- **Workout Session**: 1回のトレーニングセッションを表す。属性: セッションID、日付、記録された種目リスト、合計時間
- **Exercise**: トレーニング種目を表す。属性: 種目ID、種目名、部位、参考動画URL(オプション)
- **Set**: 1セットの記録を表す。属性: セットID、種目ID、重量(kg)、レップ数、完了日時
- **Body Part**: 部位を表す。属性: 部位ID、部位名(胸、背中、脚、肩、腕など)
- **Timer Preset**: タイマーのプリセット設定。属性: プリセットID、秒数、名前(例: "短い休憩: 60秒")

## Success Criteria _(mandatory)_

### Measurable Outcomes

- **SC-001**: ユーザーは新規ワークアウトセッションの開始から最初のセット記録まで30秒以内で完了できる
- **SC-002**: ユーザーは片手でテンキーパッドを操作し、重量とレップ数の入力を10秒以内で完了できる
- **SC-003**: タイマーがロック画面で正常に表示され、90%以上の確率で通知音とバイブレーションが正確に動作する
- **SC-004**: 過去のワークアウト履歴を日付順で閲覧する際、100件の履歴があっても2秒以内に一覧が表示される
- **SC-005**: ユーザーの95%が初回使用時に、チュートリアル無しで基本的なワークアウト記録(部位選択→種目入力→セット記録→保存)を完了できる
- **SC-006**: アプリがクラッシュした場合でも、最後に保存したデータは失われず、再起動時に復元される
- **SC-007**: ユーザーはタブバー経由で画面遷移を1秒以内に完了でき、操作に遅延を感じない
- **SC-008**: タイマー開始時に終了通知が確実にスケジュールされ、アプリが強制終了されていない場合は終了通知が届く。リアルタイム更新と対話的な操作(一時停止・再開・スキップ)はアプリ/プロセスが生存中にベストエフォートで動作し、強制終了後の動作はプラットフォーム依存(iOS: スケジュール済み終了通知のみ保証、Android: 通常停止なら継続、強制停止なら保証なし)
- **SC-009**: ユーザーの80%が「片手操作が快適」「タイマー機能が便利」とフィードバックする(ユーザー調査による)
- **SC-010**: データの読み込みと保存が1秒以内に完了し、ユーザーが待たされることがない

### Assumptions

- **A-001**: ユーザーはiOSまたはAndroid端末を使用し、通知権限を許可している
- **A-002**: ユーザーはトレーニング種目の基本的な名前(ベンチプレス、スクワットなど)を知っている
- **A-003**: ユーザーは重量をkg単位で記録する(lbs対応は将来的な拡張として考慮)
- **A-004**: ユーザーはジムでトレーニング中に片手でスマホを操作することが多い
- **A-005**: ユーザーはセット間の休憩時間を管理したいと考えている
- **A-006**: ダークテーマが標準で、ライトテーマは将来的な拡張として扱う
- **A-007**: デバイスのストレージに十分な空き容量(最低100MB)がある
- **A-008**: @capacitor-community/sqlite プラグインが正しくインストールされ、ネイティブビルドが成功している
- **A-009**: ユーザーはワークアウトデータを長期間(1年以上)保持したいと考えている
- **A-010**: SQLiteデータベースファイルは端末のアプリケーション専用ストレージに保存され、他のアプリからアクセスできない
