# ソーシャル機能: トレーニング共有とタイムライン

## 概要

友達とトレーニング内容やトレーニング中のステータスを共有できる機能と、近くの人や任意の人のトレーニングメニューをタイムライン形式で閲覧できるオープンな機能を追加する。

## モチベーション

- **モチベーション向上**: 友達のトレーニングを見ることで、自分も頑張ろうという気持ちになる
- **コミュニティ形成**: 同じジムに通う人や似たトレーニングをしている人とつながれる
- **知識共有**: 他の人のメニューを参考にして、新しい種目やトレーニング方法を学べる
- **アカウンタビリティ**: トレーニング中のステータスを共有することで、継続のモチベーションになる

## 提案機能

### 1. リアルタイムステータス共有

**機能詳細:**
- 「トレーニング中」ステータスを友達に共有
- 現在行っている種目と進捗（例: ベンチプレス 2/3セット完了）をリアルタイム表示
- トレーニング開始/終了の通知
- セッション時間の表示

**ユースケース:**
```
Given: ユーザーがワークアウトセッションを開始
When: 友達リストに登録されているユーザーがアプリを開く
Then: 友達の「トレーニング中」ステータスと現在の種目が表示される
```

### 2. トレーニング内容の共有

**機能詳細:**
- 完了したワークアウトセッションを友達またはパブリックに共有
- シェア内容: 日付、部位、種目、セット数、総時間、メモ（オプション）
- プライバシー設定: 友達のみ / 近くの人 / 全体公開
- 重量やレップ数の詳細は表示/非表示を選択可能

**ユースケース:**
```
Given: ユーザーがワークアウトセッションを完了
When: 「シェア」ボタンをタップし、公開範囲を「友達のみ」に設定
Then: 友達のタイムラインにワークアウト内容が表示される
```

### 3. タイムライン機能

**機能詳細:**
- 友達、近くの人、またはフォローしているユーザーのワークアウトをタイムライン形式で表示
- フィルター: 友達のみ / 近くの人 / 全体 / 特定の部位
- 「いいね」やコメント機能（オプション）
- 過去の投稿を遡って閲覧可能

**ユースケース:**
```
Given: タイムライン画面を開く
When: フィルターを「近くの人」に設定
Then: 位置情報に基づいて近くのユーザーのワークアウトが表示される
```

### 4. 近くの人の発見

**機能詳細:**
- 位置情報サービスを利用して、同じジムや近くでトレーニングしている人を発見
- 距離範囲の設定（例: 1km以内、5km以内）
- プライバシー設定: 位置情報の共有をオン/オフ
- 共通のトレーニング種目や部位を基にしたマッチング機能

**ユースケース:**
```
Given: 位置情報共有をオンにしている
When: 「近くの人」タブを開く
Then: 半径5km以内でトレーニング中またはトレーニング履歴がある人が表示される
```

### 5. 友達機能

**機能詳細:**
- ユーザー検索（ユーザー名、ID）
- 友達リクエストの送信/承認
- 友達リストの管理
- 友達のプロフィール閲覧（公開されているワークアウト統計など）

## 技術的考慮事項

### アーキテクチャ変更

現在のfitronixは完全にローカル/オフラインアプリですが、この機能には以下が必要です：

1. **バックエンドサーバー**
   - Node.js/Express または Firebase
   - リアルタイム通信: WebSocket or Firebase Realtime Database
   - REST API for CRUD operations

2. **ユーザー認証システム**
   - Email/Password authentication
   - OAuth (Google, Apple Sign-In)
   - JWT or Session-based authentication

3. **データ同期**
   - ローカルSQLiteデータベースとサーバー間の同期
   - 競合解決戦略（ローカル優先 vs サーバー優先）
   - オフライン時のキュー処理

4. **位置情報サービス**
   - `@capacitor/geolocation` プラグインの導入
   - 地理空間クエリ（例: PostGIS, MongoDB with geospatial indexes）

5. **プライバシーとセキュリティ**
   - ユーザーのプライバシー設定管理
   - データの暗号化（通信・保存）
   - GDPR/プライバシーポリシーへの対応

### 必要な新規依存関係

```json
{
  "dependencies": {
    "@capacitor/geolocation": "^7.x.x",
    "socket.io-client": "^4.x.x",  // リアルタイム通信用
    "axios": "^1.x.x"  // HTTP client
  }
}
```

### データモデル拡張

新しいエンティティが必要になります：

```typescript
// User
interface User {
  id: string;
  username: string;
  email: string;
  profilePicture?: string;
  privacySettings: PrivacySettings;
  location?: {
    latitude: number;
    longitude: number;
    lastUpdated: string;
  };
}

// Friend
interface Friend {
  userId: string;
  friendId: string;
  status: 'pending' | 'accepted' | 'blocked';
  createdAt: string;
}

// SharedWorkout
interface SharedWorkout {
  id: string;
  userId: string;
  sessionId: string;  // reference to WorkoutSession
  visibility: 'friends' | 'nearby' | 'public';
  showDetails: boolean;  // show weights/reps
  caption?: string;
  likes: number;
  createdAt: string;
}

// Comment (optional)
interface Comment {
  id: string;
  workoutId: string;
  userId: string;
  content: string;
  createdAt: string;
}
```

### UI/UX変更

新しい画面が必要：
- **ソーシャルタブ**: タイムライン、近くの人、友達リスト
- **プロフィール画面**: 自分のプロフィール編集、統計表示
- **ユーザー検索画面**: 友達を探す
- **プライバシー設定画面**: 共有範囲、位置情報設定

既存画面への追加：
- **ワークアウト完了画面**: 「シェア」ボタン追加
- **タブバー**: 新しい「ソーシャル」タブ追加（合計4タブ）

## 実装の段階的アプローチ

### Phase 1: 基盤構築 (P1)
- [ ] バックエンドサーバーのセットアップ
- [ ] ユーザー認証システムの実装
- [ ] ユーザープロフィール機能
- [ ] データ同期の基本実装

### Phase 2: 友達機能 (P1)
- [ ] 友達リクエスト/承認機能
- [ ] 友達リストの管理
- [ ] 友達検索機能

### Phase 3: シェアとタイムライン (P2)
- [ ] ワークアウト共有機能
- [ ] プライバシー設定
- [ ] タイムライン表示
- [ ] フィルター機能

### Phase 4: リアルタイム機能 (P2)
- [ ] トレーニング中ステータス共有
- [ ] WebSocket/Firebase Realtime Database統合
- [ ] リアルタイム通知

### Phase 5: 位置情報とマッチング (P3)
- [ ] 位置情報サービスの統合
- [ ] 「近くの人」機能
- [ ] 地理空間クエリの実装

### Phase 6: エンゲージメント機能 (P4)
- [ ] いいね機能
- [ ] コメント機能
- [ ] ワークアウト統計の共有

## プライバシーとセキュリティの考慮事項

1. **デフォルト設定**
   - デフォルトは「友達のみ」共有
   - 位置情報共有はデフォルトでオフ
   - 重量/レップ数の詳細はデフォルトで非表示

2. **ユーザーコントロール**
   - 全ての共有設定を細かく制御可能
   - いつでも過去の共有を削除可能
   - 特定のユーザーをブロック可能

3. **データ保護**
   - HTTPS通信の強制
   - サーバー側でのデータ暗号化
   - 最小限のデータ収集原則

## パフォーマンス考慮事項

- タイムラインの遅延読み込み（ページネーション）
- 位置情報クエリの最適化（インデックス、キャッシュ）
- リアルタイム更新の効率化（差分更新のみ）
- オフライン対応の維持（既存機能に影響を与えない）

## 既存機能への影響

- **互換性**: 既存のローカルデータベース機能は維持
- **オフライン優先**: ネットワーク接続がなくても基本機能は動作
- **オプトイン**: ソーシャル機能はオプションで、使いたくないユーザーは無視できる

## 成功指標

- [ ] ユーザーの30%以上が友達を1人以上追加
- [ ] ユーザーの20%以上が週に1回以上ワークアウトを共有
- [ ] タイムライン読み込み時間が2秒以内
- [ ] リアルタイムステータス更新の遅延が3秒以内
- [ ] 位置情報クエリのレスポンスが1秒以内

## 関連Issue/PR

- #1 (001-workout-tracker: 初期仕様)
- #3 (SQLite migration: データベース基盤)

## 補足

この機能は大規模な追加であり、アプリの性質を「個人用トラッキングツール」から「ソーシャルフィットネスプラットフォーム」へと変革します。段階的な実装とユーザーフィードバックの収集が重要です。

---

**Labels**: `enhancement`, `feature-request`, `social`, `backend`, `p2`
**Milestone**: v0.3.0 (ソーシャル機能MVP)
